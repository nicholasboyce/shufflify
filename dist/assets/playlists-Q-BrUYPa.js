import"./modulepreload-polyfill-9p4a8sJU.js";const q="data:image/png;base64,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",L=sessionStorage.getItem("code"),x=localStorage.getItem("client_id"),O=["select","review","complete"];let m=[],B="";sessionStorage.currState??=O[0];let f=1;if(L){await X(x,L);const t=localStorage.getItem("access_token");await Q(t)}async function X(t,e){const s=localStorage.getItem("verifier"),o=localStorage.getItem("refresh_token"),a=new URLSearchParams;a.append("client_id",t),o===null||o==="undefined"?(a.append("grant_type","authorization_code"),a.append("code",e),a.append("redirect_uri","http://localhost:5173"),a.append("code_verifier",s)):(a.append("grant_type","refresh_token"),a.append("refresh_token",o));const c=await(await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a})).json();localStorage.setItem("access_token",c.access_token),localStorage.setItem("refresh_token",c.refresh_token)}async function D(t){const s=await(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json();return sessionStorage.user_id=s.id,sessionStorage.product=s.product,s}async function I(t){return await(await fetch("https://api.spotify.com/v1/me/playlists",{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json()}async function Q(t){sessionStorage.currState="select";const e=await D(t);M(e),await h(t)}function M(t){const e=document.querySelector(".display-name");e.textContent=`Hi, ${t.display_name}!`;const s=document.querySelector(".profile-photo"),o=document.querySelector(".photo-wrapper"),a=document.querySelector(".log-out");o.addEventListener("click",()=>{a.classList.toggle("show")}),a.addEventListener("click",()=>{P(),console.log("Logged out safely!")}),t.images.length>0?s.src=t.images.url:s.src=q}function P(){localStorage.clear(),sessionStorage.clear(),window.location="/"}function b(t){const e=document.createElement("input");e.setAttribute("list",`playlist-names-${f}`),e.setAttribute("id",`${f}`),e.setAttribute("name",`playlist-${f}`);const s=document.createElement("datalist");s.setAttribute("id",`playlist-names-${f}`);for(const o of t){const a=document.createElement("option");a.dataset.value=o.id,a.value=a.textContent=o.name,s.appendChild(a)}return f++,[e,s]}async function U(t,e){return(await(await fetch(`https://api.spotify.com/v1/playlists/${e}/tracks`,{method:"GET",headers:{Authorization:`Bearer ${t}`}})).json()).items.map(i=>({name:i.track.name,artists:i.track.artists,uri:i.track.uri,images:i.track.album.images}))}async function h(t){const e=document.querySelector(".app"),s=document.querySelector(".instructions");switch(sessionStorage.currState){case"select":s.textContent="Select up to 4 playlists to shuffle together!",e.textContent="";const a=(await I(t)).items?.map(n=>({name:n.name,uri:n.uri,public:n.public,images:n.images,id:n.id}));sessionStorage.playlists=JSON.stringify(a);const i=document.createElement("form");i.setAttribute("method","GET"),i.setAttribute("action","/playlists/");const c=document.createElement("div");c.classList.add("button-wrapper"),sessionStorage.playlistAmountState=2;const l=document.createElement("button");l.classList.add("less-playlists"),l.textContent="Remove one",l.addEventListener("click",n=>{n.preventDefault();let r=Number(sessionStorage.playlistAmountState);r<=2||(r-=1,sessionStorage.playlistAmountState=r,document.querySelector("input").remove())});const y=document.createElement("button");y.classList.add("more-playlists"),y.textContent="Select another",y.addEventListener("click",n=>{n.preventDefault();let r=Number(sessionStorage.playlistAmountState);if(r>=4)return;r+=1,sessionStorage.playlistAmountState=r,b(a).forEach(d=>i.appendChild(d))});const p=document.createElement("button");i.appendChild(c),c.appendChild(l),c.appendChild(y),c.appendChild(p),p.type="submit",p.classList.add("shuffle-button"),p.textContent="Shuffle!",p.addEventListener("click",async n=>{n.preventDefault();const r=[],w=document.querySelectorAll("form input");for(const d of w)r.push(document.querySelector(`#${d.list.id} option[value='${d.value}']`).dataset.value);for(const d of r)(await U(t,d)).forEach(T=>m.push(T));sessionStorage.currState="review",await h(t)}),e.appendChild(i);let v=b(a);v.forEach(n=>i.appendChild(n)),v=b(a),v.forEach(n=>i.appendChild(n));break;case"review":s.textContent="Review your shuffle!",e.textContent="",z(m);const A=document.createElement("div");A.classList.add("track-list"),e.appendChild(A);for(const n of m)A.appendChild(F(n));const g=document.createElement("button");g.classList.add("reshuffle-button"),g.textContent="Reshuffle",g.addEventListener("click",async n=>{n.preventDefault(),await h(t)});const E=document.createElement("button");if(E.classList.add("create-playlist-button"),E.textContent="Create playlist",E.addEventListener("click",async n=>{n.preventDefault(),B=(await K(t,m)).external_urls.spotify,sessionStorage.currState="complete",await h(t)}),sessionStorage.product==="premium"){const n=document.createElement("button");n.classList.add("add-to-queue-button"),n.addEventListener("click",async r=>{r.preventDefault();for(const w of m)await R(t,w.uri)})}const u=document.createElement("div");u.classList.add("button-wrapper"),u.appendChild(g),u.appendChild(E),typeof addToQueueBtn<"u"&&u.appendChild(addToQueueBtn),e.appendChild(u);break;case"complete":s.textContent="Click above to check out your new shuffled playlist!",e.textContent="";const k=document.querySelector(".spotify-connect");k.style.display="flex",k.addEventListener("click",()=>{window.open(B,"_blank")});const S=document.createElement("button");S.textContent="Let's go again!",S.addEventListener("click",n=>{n.preventDefault(),sessionStorage.currState="select",h(t)});const C=document.createElement("button");C.textContent="Log out",C.addEventListener("click",P),S.style.width=C.style.width="10rem",e.appendChild(S),e.appendChild(C);break}}function z(t){for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}}function F(t){const e=document.createElement("div");e.classList.add("card");const s=document.createElement("img");s.classList.add("album-art"),s.src=t.images[0].url;const o=document.createElement("div");o.classList.add("card-textContent");const a=document.createElement("h3");a.textContent=t.name;const i=document.createElement("p");return i.textContent=t.artists[0].name,e.appendChild(s),e.appendChild(o),o.appendChild(a),o.appendChild(i),e}async function R(t,e){await fetch("https://api.spotify.com/v1/me/player/queue",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:new URLSearchParams({uri:e})})}async function K(t,e){const s=sessionStorage.user_id,o=prompt("Name of playlist:"),a=prompt("Description of playlist:"),c=await(await fetch(`https://api.spotify.com/v1/users/${s}/playlists`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({name:o??"Shufflify Playlist",public:!1,description:a??"A playlist created by Shufflify."})})).json();return console.log(c),await fetch(`https://api.spotify.com/v1/playlists/${c.id}/tracks`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({uris:e.map(l=>l.uri)})}),c}
